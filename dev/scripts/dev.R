

# make hexsticker ---------------------------------------------------------

library(showtext)
font_add_google("Antonio", "ant")
showtext_auto()

image_read("dev/images/crop-circle-2.jpg") |>
  image_modulate(brightness = 40) |>
  image_write("dev/images/crop-circle-3.jpg")

sticker(
  "dev/images/crop-circle-3.jpg",
  package = "cropcircles",
  p_size=20,
  s_x=1,
  s_y=1,
  s_width=2,
  s_height=2,
  p_y = 0.55,
  p_color = "#d6ccc2",
  p_fontface = "bold",
  p_family = "ant",
  h_color = "#d6ccc2",
  h_size = 2,
  filename="dev/images/hex-staging.png")

# test function -----------------------------------------------------------

images <- c(
  'https://openpsychometrics.org/tests/characters/test-resources/pics/BB/9.jpg',
  "dev/images/moss-beast.jpg",
  "dev/images/tolosh.jpg",
  "dev/images/baal.jpg"
)

x <- circle_crop(images)

image_read(x) |>
  magick::image_montage()

#' Download images
#'
#' If the images are a URL they will be downloaded and saved in a temporary location.
#' The images are cleared when the session ends
#'
#' @param images A vector of URLs to image location
#'
#' @importFrom utils download.file
#'
#' @return The paths to the downloaded images
#' @export
#'
#' @examples \dontrun{
#' images <- c(
#'   'https://openpsychometrics.org/tests/characters/test-resources/pics/BB/1.jpg',
#'   'https://openpsychometrics.org/tests/characters/test-resources/pics/BB/3.jpg',
#'   'https://openpsychometrics.org/tests/characters/test-resources/pics/BB/9.jpg'
#'   )
#'
#' download_images(images)
#' }
download_images <- function(images) {
  dest <- purrr::map_chr(1:length(images), ~tempfile(pattern = "cropped", tmpdir = tempdir(), fileext = ".png"))
  download.file(images, dest, mode = "wb", quiet = TRUE)
  dest
}

#' Is URL
#'
#' Checks if the given address is a URL or not. Returns a logical vector.
#'
#' @param path Path to image
#'
#' @return Logical vector. `TRUE` if path is a url. `FALSE` otherwise
#' @export
#'
#' @examples
#'  is_url('https://openpsychometrics.org/tests/characters/test-resources/pics/BB/1.jpg')
#'
#'  is_url("C:/path_to_not_url/image.png")
is_url <- function(path) {
  base::substr(path, 1, 4) == "http"
}
